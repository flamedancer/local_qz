{% extends "admin/base.html" %}
{% block head %}
<link rel="stylesheet" href="../../../admin/js/bootstrap/dist/css/bootstrap.min.css" />
{% endblock head %}

{% block main %}
<div class="panel panel-primary">
    <div class="panel-body">
        {% if not subarea %}
            <h4>当前默认分区{{ subarea_default }} </h4>
        {% else %}
            <h4>当前分区号  {{subarea}} </h4>
        {% endif %}
            {% for config in subareas_conf %}
                {% if config.0 == subarea%}
                    <a href="/admin/game_setting/?subarea={{ config.0 }}" style="color:red;font-size:14px;">{{ config.0 }}区：{{ config.1 }}</a>&nbsp;<span style="color:grey;font-size:1.3em;">|</span> 
                {% else %}
                    <a href="/admin/game_setting/?subarea={{ config.0 }}" style="color:blue;font-size:14px;">{{ config.0 }}区：{{ config.1 }}</a>&nbsp;<span style="color:grey;font-size:1.3em;">|</span> 
                {% endif %}
            {% endfor %}
    </div>
</div>
{% if not subarea %}
<a href="?config_name=subareas_conf" style="color:blue;font-size:14px;">分区设置</a>
{% endif %}

{% if subarea %}
<div class="panel panel-primary">
    <div class="panel-body">
        {% for config in g_l_config %}
            {% if forloop.last %}
                <a href="?config_name={{ config.name }}&subarea={{subarea}}" style="color:blue;font-size:14px;">{{ config.description }}</a>
            {% else %}
                <a href="?config_name={{ config.name }}&subarea={{subarea}}" style="color:blue;font-size:14px;">{{ config.description }}</a>&nbsp;<span style="color:grey;font-size:1.3em;">|</span>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

<div id="report">
	{% if saved %}
	<span style="color: red">保存成功</span>
	{% endif %}
    {% if config_name %}
        <div class="alert alert-danger hide">你提交的设置有问题喔，没有成功保存设置：&nbsp;<span class="error-message"></span></div>
        <form action="/admin/xls_to_dict_test/submit_game_settings_by_excel/?config_name={{ config_name }}" method="post" enctype="multipart/form-data">
           <input type="file" name='xls' value="上传文件" />
           {% if submit_game_settings_by_excel %}
               <input type="hidden" name="subarea_default" value="{{ subarea_default }}">
           {% else %}
               <input type="hidden" name="subarea_default" value="{{ subarea }}">
           {% endif %}
           <input type="submit" value="开始生成配置" />
        </form>
        {% if subarea %}
            <form id='settings_form' action="/admin/game_setting/?config_name={{ config_name }}&subarea={{ subarea }}" method="post" enctype="multipart/form-data">
        {% else %}
            <form id='settings_form' action="/admin/save_game_settings/?config_name={{ config_name }}" method="post" enctype="multipart/form-data">
        {% endif %}
        <span style="color: red">正在修改:{{ config_title }}</span>
        <input type="submit" id="submit_game_settings" value="提交" /> 
        {% if submit_game_settings_by_excel %}
            <input type="hidden" name="subarea_default_save" value="{{ subarea_default }}">
            <select name="subarea_list" multiple="multiple">
               {% for config in subareas_conf %}
                   <option value="{{ config.0 }}">{{ config.0 }}区:_{{ config.1 }}</option>
               {% endfor %}
            </select>
        {% endif %}
        <textarea name="config_value" class="hide">{{ config_value }}</textarea>
        <div id="ace-editor" style="width:90%;height:500px;font-size:12px;border:1px solid black;">{{ config_value }}</div><br />
        </form>
        {% for record in updateconfrecord %}
            {{record}}
            <br/>
        {% endfor %}
    {% endif %}
</div>
<script type="text/javascript" src="../../../admin/js/jquery/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="../../../admin/js/ace/ace.js"></script>
<script type="text/javascript" src="../../../admin/js/ace/theme-github.js"></script>
<script type="text/javascript" src="../../../admin/js/ace/mode-python.js"></script>
<script type="text/javascript">
    if($('textarea[name="config_value"]')) {
        var $textarea = $('textarea[name="config_value"]');
        var $editor = $('#ace-editor');
        var editor = ace.edit('ace-editor');
        editor.setTheme("ace/theme/github");

        var PyMode = require("ace/mode/python").Mode;
        editor.getSession().setMode(new PyMode());

        editor.getSession().setTabSize(4);
        editor.getSession().setUseSoftTabs(true);
        editor.getSession().on('change', function() {
        });

        $('#settings_form').submit(function(e) {
        	  $textarea.val(editor.getSession().getValue());
            var $form = $(this);
            var config_value = $textarea.val();
        });
    }
</script>
{% endblock main %}
